{"version":3,"sources":["components/CreatePost.js"],"names":["CKEditor","React","lazy","Post","withRouter","dispatch","useDispatch","history","useHistory","useSelector","state","common","dark","isUserLoggedIn","useState","user","setUser","useQuery","a","axios","get","onSuccess","data","details","enabled","Boolean","tags","setTags","previewMode","setPreviewMode","title","category","content","formData","setFormData","validatonSchema","Yup","required","KeyCodes","delimiters","handleAdd","tag","pascalCase","text","some","tagText","id","handleDelete","indexToRemove","filter","_","i","debounce","useCallback","db","value","Object","assign","generatePreviewData","values","tagsList","forEach","tagObj","push","authorId","_id","authorName","name","authorUsername","username","createPostMutation","useMutation","v","post","createDraftMutation","handleSubmit","props","mutate","success","resetForm","SUCCESS","message","type","payload","ERROR","onError","error","response","handleDraftSubmit","className","clsx","onClick","fallback","body","preview","initialValues","onSubmit","validationSchema","onBlur","as","onKeyDown","e","parseInt","target","style","height","scrollHeight","placeholder","htmlFor","autofocus","handleAddition","inputFieldPosition","allowUnique","classNames","tagInput","tagInputField","remove","activeClass","events","change","editor","getData","config","removeButtons","disabled","isValid"],"mappings":"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","file":"static/js/13.fa4daee1.chunk.js","sourcesContent":["import React, { useState, useCallback, Suspense } from \"react\";\nimport clsx from \"clsx\";\nimport \"styles/createPost.scss\";\nimport { WithContext as ReactTags } from \"react-tag-input\";\nimport { pascalCase } from \"change-case\";\nimport { useSelector } from \"react-redux\";\nimport { Formik, Form, Field, ErrorMessage } from \"formik\";\nimport { create, debounce as db } from \"lodash\";\nimport { AiOutlineEye } from \"react-icons/ai\";\nimport { IoCreateOutline } from \"react-icons/io5\";\nimport Loading from \"./Loading\";\nimport * as Yup from \"yup\";\nimport axios from \"axios\";\nimport { useDispatch } from \"react-redux\";\nimport { ERROR, INFO, SUCCESS } from \"redux/constants\";\nimport { withRouter, useHistory } from \"react-router-dom\";\nimport { useMutation, useQuery } from \"react-query\";\nconst CKEditor = React.lazy(() => import(\"react-ckeditor-component\"));\nconst Post = React.lazy(() => import(\"./Post\"));\nfunction CreatePost() {\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const { dark, isUserLoggedIn } = useSelector((state) => state.common);\n  const [user, setUser] = useState({});\n\n  let { data } = useQuery(\n    \"userData\",\n    async () => await axios.get(\"/user/fetchUserInfo\"),\n    {\n      onSuccess: ({ data }) => {\n        setUser(data.details);\n      },\n      enabled: Boolean(isUserLoggedIn),\n    }\n  );\n\n  const [tags, setTags] = useState([]);\n  const [previewMode, setPreviewMode] = useState(false);\n  const [formData, setFormData] = useState({\n    title: \"\",\n    category: \"Undefined\",\n    tags: [],\n    content: \"\",\n  });\n  const validatonSchema = Yup.object({\n    title: Yup.string().required(\"Post title is required.\"),\n    category: Yup.string(),\n    tags: Yup.array(),\n    content: Yup.string(),\n  });\n\n  const KeyCodes = {\n    comma: 188,\n    enter: [10, 13],\n  };\n  const delimiters = [...KeyCodes.enter, KeyCodes.comma];\n  const handleAdd = (tag) => {\n    tag = pascalCase(tag.text);\n    if (!tag) {\n      return;\n    }\n    if (tags.some((tagText) => tagText.text === tag)) {\n      return;\n    }\n    setTags([...tags, { id: tag, text: tag }]);\n  };\n  const handleDelete = (indexToRemove) => {\n    setTags(() => tags.filter((_, i) => indexToRemove !== i));\n  };\n\n  const debounce = useCallback(\n    db((value) => {\n      setFormData(Object.assign(formData, { content: value }));\n    }, 300),\n    []\n  );\n\n  const generatePreviewData = async (values) => {\n    let tagsList = [];\n    tags.forEach((tagObj) => {\n      tagsList.push(tagObj.id);\n    });\n\n    setFormData(\n      Object.assign(\n        formData,\n        { title: values.title, category: values.category },\n        { tags: tagsList },\n        {\n          authorId: user._id,\n          authorName: user.name,\n          authorUsername: user.username,\n        }\n      )\n    );\n  };\n\n  const createPostMutation = useMutation((v) =>\n    axios.post(\"/post/create-post?submitType=publish\", v)\n  );\n\n  const createDraftMutation = useMutation((v) =>\n    axios.post(\"/post/create-post?submitType=draft\", v)\n  );\n\n  const handleSubmit = async (values, props) => {\n    await generatePreviewData(values);\n    createPostMutation.mutate(formData, {\n      onSuccess: async ({ data }) => {\n        if (data.success) {\n          props.resetForm();\n          setFormData({\n            title: \"\",\n            category: \"\",\n            tags: [],\n            content: \"\",\n          });\n\n          dispatch({\n            type: SUCCESS,\n            payload: await data?.message,\n          });\n          return history.push(\"/\");\n        }\n        dispatch({\n          type: ERROR,\n          payload: await data?.message,\n        });\n      },\n      onError: (error) => {\n        dispatch({\n          type: ERROR,\n          payload: error.response.data.message,\n        });\n      },\n    });\n  };\n\n  const handleDraftSubmit = async (props) => {\n    await generatePreviewData(props.values);\n    createDraftMutation.mutate(formData, {\n      onSuccess: async ({ data }) => {\n        if (data.success) {\n          props.resetForm();\n          setFormData({\n            title: \"\",\n            category: \"\",\n            tags: [],\n            content: \"\",\n          });\n\n          dispatch({\n            type: SUCCESS,\n            payload: await data?.message,\n          });\n          return history.push(\"/\");\n        }\n        dispatch({\n          type: ERROR,\n          payload: await data?.message,\n        });\n      },\n      onError: (error) => {\n        dispatch({\n          type: ERROR,\n          payload: error.response.data.message,\n        });\n      },\n    });\n  };\n\n  return (\n    <div\n      className={clsx(\n        \"create_post py-4 p-2 p-sm-4\",\n        dark ? \"create_post_dark\" : \"create_post_light\"\n      )}\n    >\n      <div className=\"container\">\n        <div className=\"row mb-2 align-items-center\">\n          <div className=\"col-8 col-sm-9\">\n            <h2>{previewMode ? \"Preview mode\" : \"Create a post\"}</h2>\n          </div>\n          <div className=\"col-4 col-sm-3 preview-btn \">\n            <button\n              className=\"btn btn-sm  ms-auto shadow-none\"\n              onClick={() => setPreviewMode(!previewMode)}\n            >\n              {previewMode ? (\n                <>\n                  Edit <IoCreateOutline />\n                </>\n              ) : (\n                <>\n                  {\" \"}\n                  Preview <AiOutlineEye />\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n        {previewMode ? (\n          <Suspense fallback={<Loading />}>\n            <Post\n              title={formData.title}\n              category={formData.category}\n              body={formData.content}\n              preview={true}\n            />\n          </Suspense>\n        ) : (\n          <Formik\n            initialValues={formData}\n            onSubmit={handleSubmit}\n            validationSchema={validatonSchema}\n          >\n            {(props) => (\n              <Form\n                className=\"p-3\"\n                onBlur={() => generatePreviewData(props.values)}\n              >\n                <div className=\"mb-3\">\n                  <Field\n                    as=\"textarea\"\n                    onKeyDown={(e) => {\n                      if (parseInt(e.target.style.height) >= 300) {\n                        return;\n                      }\n                      e.target.style.height = \"inherit\";\n                      e.target.style.height = `${e.target.scrollHeight}px`;\n                    }}\n                    name=\"title\"\n                    className=\"form-control shadow-none post-title\"\n                    placeholder=\"New post title here\"\n                  />\n                  <small className=\"text-danger\">\n                    <ErrorMessage name=\"title\" />\n                  </small>\n                </div>\n                <div className=\"mb-3 tags-cont\">\n                  <label htmlFor=\"post-tags\" className=\"form-label\">\n                    Tags\n                  </label>\n                  <ReactTags\n                    tags={tags}\n                    autofocus={false}\n                    handleAddition={handleAdd}\n                    handleDelete={handleDelete}\n                    delimiters={delimiters}\n                    inputFieldPosition=\"inline\"\n                    allowUnique={false}\n                    classNames={{\n                      tags: \"tags\",\n                      tag: \"tag\",\n                      tagInput: \"tagInput\",\n                      tagInputField: \"tagInputField\",\n                      remove: \"tagRemoveBtn\",\n                    }}\n                  />\n                </div>\n                <div className=\"mb-3 category-cont\">\n                  <label htmlFor=\"category\" className=\"form-label\">\n                    Category\n                  </label>\n                  <Field\n                    as=\"select\"\n                    name=\"category\"\n                    id=\"category\"\n                    className=\"form-control shadow-none\"\n                  >\n                    <option value=\"Undefined\">Undefined</option>\n                    <option value=\"Crime\">Crime</option>\n                    <option value=\"Food\">Food</option>\n                    <option value=\"Travel\">Travel</option>\n                    <option value=\"Fashion\">Fashion</option>\n                    <option value=\"DIY\">DIY</option>\n                    <option value=\"Music\">Music</option>\n                    <option value=\"Sports\">Sports</option>\n                    <option value=\"E-sports\">E-sports</option>\n                    <option value=\"Fitness\">Fitness</option>\n                    <option value=\"Business\">Business</option>\n                    <option value=\"Politics\">Politics</option>\n                    <option value=\"Movie\">Movie</option>\n                    <option value=\"Science\">Science</option>\n                    <option value=\"Technology\">Technology</option>\n                    <option value=\"News\">News</option>\n                  </Field>\n                </div>\n                <div className=\"editor-cont mb-3\">\n                  <label htmlFor=\"post-body\" className=\"form-label\">\n                    Body\n                  </label>\n\n                  <Suspense fallback={<Loading />}>\n                    <CKEditor\n                      content={formData.content}\n                      activeClass=\"editor\"\n                      events={{\n                        change: (e) => debounce(e.editor.getData()),\n                      }}\n                      config={{\n                        removeButtons:\n                          \"Cut,Copy,Paste,Anchor,Scayt,PasteText,PasteFromWord,About\",\n                      }}\n                    />\n                  </Suspense>\n                </div>\n                <div className=\"d-flex justify-content-end\">\n                  <button\n                    className=\"btn btn-secondary shadow-none me-3\"\n                    onClick={() => {\n                      handleDraftSubmit(props);\n                    }}\n                    type=\"button\"\n                  >\n                    Save draft\n                  </button>\n                  <button\n                    type=\"submit\"\n                    className=\"btn btn-primary  shadow-none\"\n                    disabled={!props.isValid}\n                  >\n                    Post\n                  </button>\n                </div>\n              </Form>\n            )}\n          </Formik>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default withRouter(CreatePost);\n"],"sourceRoot":""}